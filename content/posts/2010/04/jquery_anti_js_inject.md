```toml
title = "使用jquery对特殊字符进行转义,防止js注入"
slug = "jquery_anti_js_inject"
description = ""
date = "2010-04-23 14:44:17"
author = "admin"
tags = ["jquery","注入","转义"]
```

在使用ajax进行留言的时候,出现了一个问题.因为留言内容写完之后,通过ajax提交内容,同时使用js把留言的内容添加到页面上来.浏览留言的时候也是通过ajax请求,然后再显示的.这样,如果有人在留言里写入了js语句,这结语句都会被执行.解决办法就是对这些特殊字符进行转义再显示出来.如果在jsp中使用jstl标签,就很简单了.直接使用<c:out value=”${r.content}” />这样就行了,会自动进行转义,其中省略了参数escapeXML=”true”,这是默认的.所以说在显示这些用户提交的内容的时候不要用el表达示,因为el不会自动进行转义,用c:out比较好.而如果也是通过ajax请求,然后再显示的,那就用下面的方法.其实也很简单.


<!--more-->

<p>在使用ajax进行留言的时候,出现了一个问题.因为留言内容写完之后,通过ajax提交内容,同时使用js把留言的内容添加到页面上来.浏览留言的时候也是通过ajax请求,然后再显示的.这样,如果有人在留言里写入了js语句,这结语句都会被执行.解决办法就是对这些特殊字符进行转义再显示出来.如果在jsp中使用jstl标签,就很简单了.直接使用&lt;c:out value=”${r.content}” /&gt;这样就行了,会自动进行转义,其中省略了参数escapeXML=”true”,这是默认的.所以说在显示这些用户提交的内容的时候不要用el表达示,因为el不会自动进行转义,用c:out比较好.而如果也是通过ajax请求,然后再显示的,那就用下面的方法.其实也很简单.</p>  ``````  1: <span style="color: #0000ff">var</span> html=&quot;<span style="color: #8b0000">&lt;script&gt;alert('asdfasdf')&lt;\/script&gt;</span>&quot;;``````  2: $(&quot;<span style="color: #8b0000">#content</span>&quot;).text(html);`````````&#160;``````那么会发生什么情况 ``````解决办法很简单 就是把这些特殊字符进行转义``````也就是&lt;变成&amp;lt;``````&gt;变成&amp;gt; ``````使用jquery对字符进行转义这样就可以了``````&#160;`````````  1: <span style="color: #0000ff">&lt;</span><span style="color: #800000">head</span><span style="color: #0000ff">&gt;</span>``````  2: <span style="color: #0000ff">&lt;</span><span style="color: #800000">script</span><span style="color: #0000ff">&gt;</span>``````  3: var html=&quot;<span style="color: #0000ff">&lt;</span><span style="color: #800000">script</span><span style="color: #0000ff">&gt;</span>alert('asdfasdf')<span style="color: #0000ff">&lt;</span>\/scipt<span style="color: #0000ff">&gt;</span>&quot;;``````  4: html=$(&quot;#x&quot;).text(html).html();``````  5: $(&quot;#content&quot;).append(&quot;<span style="color: #0000ff">&lt;</span><span style="color: #800000">div</span><span style="color: #0000ff">&gt;</span>&quot;+html+&quot;<span style="color: #0000ff">&lt;/</span><span style="color: #800000">div</span><span style="color: #0000ff">&gt;</span>&quot;);``````  6: <span style="color: #0000ff">&lt;/</span><span style="color: #800000">script</span><span style="color: #0000ff">&gt;</span>``````  7: <span style="color: #0000ff">&lt;/</span><span style="color: #800000">head</span><span style="color: #0000ff">&gt;</span>``````  8: <span style="color: #0000ff">&lt;</span><span style="color: #800000">body</span><span style="color: #0000ff">&gt;</span>``````  9: <span style="color: #0000ff">&lt;</span><span style="color: #800000">span</span> <span style="color: #ff0000">id</span>=<span style="color: #0000ff">&quot;x&quot;</span> <span style="color: #ff0000">style</span>=<span style="color: #0000ff">&quot;display:none&quot;</span><span style="color: #0000ff">&gt;</span><span style="color: #0000ff">&lt;/</span><span style="color: #800000">span</span><span style="color: #0000ff">&gt;</span>`````` 10: <span style="color: #0000ff">&lt;</span><span style="color: #800000">div</span> <span style="color: #ff0000">id</span>=<span style="color: #0000ff">&quot;content&quot;</span><span style="color: #0000ff">&gt;</span><span style="color: #0000ff">&lt;/</span><span style="color: #800000">div</span><span style="color: #0000ff">&gt;</span>`````` 11: <span style="color: #0000ff">&lt;/</span><span style="color: #800000">body</span><span style="color: #0000ff">&gt;</span>`````````&#160;```
