```toml
title = "在使用豆瓣api时网址里含有汉字，显示wrong encoding错误"
slug = "douban_api_character_wrong_encoding"
desc = ""
date = "2010-05-18 16:27:35"
author = "admin"
tags = ["api","http","java","豆瓣"]
```

<p>在用java做豆瓣api应用时，发现一个问题，在搜索的时候，关键字里只能有数字和英文，含有汉字的话会出异常。 大家可以试试这个网址 &nbsp; http://api.douban.com/music/subjects?q=许嵩&amp;start-index=1 &nbsp; &nbsp; 用chrome可以正常打开，但ie和firefox都无法打开 。显示 &nbsp;wrong encoding.。。在这里深深赞chrome一个。 现在知道错误在哪儿 就好办了。 我开</p>


<!--more-->

<p>在用java做豆瓣api应用时，发现一个问题，在搜索的时候，关键字里只能有数字和英文，含有汉字的话会出异常。</p><p>大家可以试试这个网址</p><p>http://api.douban.com/music/subjects?q=许嵩</p><p>用chrome可以正常打开，但ie和firefox都无法打开 。显示 &nbsp;wrong encoding.。。在这里深深赞chrome一个。</p><p>现在知道错误在哪儿 就好办了。</p><p>我开始没有用httpclient，蛤用URL类自己写的读网络（现在知道还是必须得用，因为URL类我只会GET方法，不会put &nbsp;delete.。说来惭愧啊，我都没听说过还有delete方法。）</p><p>&nbsp;</p><p>看代码吧</p><p>ReadFromURL.java</p><p>&nbsp;</p><p>&nbsp;</p><p>package org.zzp.douban;</p><p>&nbsp;</p><p>import java.io.BufferedReader;</p><p>import java.io.IOException;</p><p>import java.io.InputStream;</p><p>import java.io.InputStreamReader;</p><p>import java.io.UnsupportedEncodingException;</p><p>import java.net.MalformedURLException;</p><p>import java.net.URL;</p><p>import java.net.URLConnection;</p><p>&nbsp;</p><p>import org.dom4j.Document;</p><p>import org.dom4j.DocumentException;</p><p>import org.dom4j.DocumentHelper;</p><p>&nbsp;</p><p>/**</p><p>&nbsp;* @author Tony 功能：通过url从网络读取数据</p><p>&nbsp;*/</p><p>public class DD {</p><p><span class="Apple-tab-span" style="white-space:pre">	</span>private URL url = null;</p><p>&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">	</span>public DD(String url) {</p><p><span class="Apple-tab-span" style="white-space:pre">		</span>try {</p><p><span class="Apple-tab-span" style="white-space:pre">			</span>this.url = new URL(url);</p><p><span class="Apple-tab-span" style="white-space:pre">		</span>} catch (MalformedURLException e) {</p><p><span class="Apple-tab-span" style="white-space:pre">			</span>System.out.println(&quot;url错误&quot;);</p><p><span class="Apple-tab-span" style="white-space:pre">			</span>e.printStackTrace();</p><p><span class="Apple-tab-span" style="white-space:pre">		</span>}</p><p><span class="Apple-tab-span" style="white-space:pre">	</span>}</p><p>&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">	</span>/**</p><p><span class="Apple-tab-span" style="white-space:pre">	</span> * @return Document通过URL从网络读取到的内容。org.dom4j.Document格式</p><p><span class="Apple-tab-span" style="white-space:pre">	</span> */</p><p><span class="Apple-tab-span" style="white-space:pre">	</span>public Document getDocument() {</p><p><span class="Apple-tab-span" style="white-space:pre">		</span>// 构建输入流等</p><p><span class="Apple-tab-span" style="white-space:pre">		</span>URLConnection uc = null;</p><p><span class="Apple-tab-span" style="white-space:pre">		</span>InputStream in = null;</p><p><span class="Apple-tab-span" style="white-space:pre">		</span>BufferedReader br = null;</p><p><span class="Apple-tab-span" style="white-space:pre">		</span>StringBuffer sb = new StringBuffer();</p><p><span class="Apple-tab-span" style="white-space:pre">		</span>try {</p><p><span class="Apple-tab-span" style="white-space:pre">			</span>uc = url.openConnection();</p><p><span class="Apple-tab-span" style="white-space:pre">		</span>} catch (IOException e) {</p><p><span class="Apple-tab-span" style="white-space:pre">			</span>System.out.println(&quot;打开url连接失败&quot;);</p><p><span class="Apple-tab-span" style="white-space:pre">			</span>e.printStackTrace();</p><p><span class="Apple-tab-span" style="white-space:pre">		</span>}</p><p><span class="Apple-tab-span" style="white-space:pre">		</span>try {</p><p><span class="Apple-tab-span" style="white-space:pre">			</span>in = uc.getInputStream();</p><p><span class="Apple-tab-span" style="white-space:pre">		</span>} catch (IOException e) {</p><p><span class="Apple-tab-span" style="white-space:pre">			</span>System.out.println(&quot;从url打开输入流失败&quot;);</p><p><span class="Apple-tab-span" style="white-space:pre">			</span>e.printStackTrace();</p><p><span class="Apple-tab-span" style="white-space:pre">		</span>}</p><p><span class="Apple-tab-span" style="white-space:pre">		</span>try {</p><p><span class="Apple-tab-span" style="white-space:pre">			</span><span style="color: rgb(255, 0, 0); ">br = new BufferedReader(new InputStreamReader(in,&quot;UTF-8&quot;));</span></p><p><span class="Apple-tab-span" style="white-space:pre">		</span>} catch (UnsupportedEncodingException e1) {</p><p><span class="Apple-tab-span" style="white-space:pre">			</span>// TODO Auto-generated catch block</p><p><span class="Apple-tab-span" style="white-space:pre">			</span>e1.printStackTrace();</p><p><span class="Apple-tab-span" style="white-space:pre">		</span>}</p><p>&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">		</span>// 开始从网络读取数据</p><p><span class="Apple-tab-span" style="white-space:pre">		</span>String line = null;</p><p><span class="Apple-tab-span" style="white-space:pre">		</span>try {</p><p><span class="Apple-tab-span" style="white-space:pre">			</span>while ((line = br.readLine()) != null) {</p><p><span class="Apple-tab-span" style="white-space:pre">				</span>sb.append(line);</p><p><span class="Apple-tab-span" style="white-space:pre">			</span>}</p><p><span class="Apple-tab-span" style="white-space:pre">		</span>} catch (IOException e) {</p><p><span class="Apple-tab-span" style="white-space:pre">			</span>System.out.println(&quot;从url输入流中读取数据失败&quot;);</p><p><span class="Apple-tab-span" style="white-space:pre">			</span>e.printStackTrace();</p><p><span class="Apple-tab-span" style="white-space:pre">		</span>} finally {</p><p><span class="Apple-tab-span" style="white-space:pre">			</span>try {</p><p><span class="Apple-tab-span" style="white-space:pre">				</span>br.close();</p><p><span class="Apple-tab-span" style="white-space:pre">				</span>in.close();</p><p><span class="Apple-tab-span" style="white-space:pre">			</span>} catch (IOException e) {</p><p><span class="Apple-tab-span" style="white-space:pre">				</span>System.out.println(&quot;关闭流失败&quot;);</p><p><span class="Apple-tab-span" style="white-space:pre">				</span>e.printStackTrace();</p><p><span class="Apple-tab-span" style="white-space:pre">			</span>}</p><p><span class="Apple-tab-span" style="white-space:pre">		</span>}</p><p>&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">		</span>Document doc = null;</p><p><span class="Apple-tab-span" style="white-space:pre">		</span>try {</p><p><span class="Apple-tab-span" style="white-space:pre">			</span>doc = DocumentHelper.parseText(sb.toString());</p><p><span class="Apple-tab-span" style="white-space:pre">		</span>} catch (DocumentException e) {</p><p><span class="Apple-tab-span" style="white-space:pre">			</span>e.printStackTrace();</p><p><span class="Apple-tab-span" style="white-space:pre">		</span>}</p><p>&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">		</span>return doc;</p><p><span class="Apple-tab-span" style="white-space:pre">	</span>}</p><p>}</p><p>&nbsp;</p><p>注意红色的这句，用UTF-8进行编码的。</p><p>那也把关键词编码为UTF-8就可以了</p><p><span style="color: rgb(255, 0, 0); ">url.append(&quot;&amp;q=&quot; + URLEncoder.encode(q,&quot;UTF-8&quot;));</span></p><p>&nbsp;</p>
